---

- name: Ensure Unity MediaScanner is removed (useless + cause high CPU peaks)
  apt: pkg={{ item }} purge=yes state=absent
  with_items:
    - mediascanner2.0
    - libmediascanner-2.0-0

- name: Remove Amazon and others Unity shits
  apt: pkg={{ item }} purge=yes state=absent
  with_items:
    - unity-lens-shopping
    - unity-scope-video-remote
    - unity-scope-musicstores
    - unity-scope-gdrive
    - unity-scope-gmusicbrowser
    - unity-scope-gourmet
    - unity-scope-guayadeque
    - unity-scope-musicstores
    - unity-scope-musique
    - unity-scope-googlenews
    - unity-scope-launchpad
    - unity-scope-onlinemusic
    - unity-scope-yahoostock

- name: Remove shitty Amazon shortcut
  file: path=/usr/share/applications/ubuntu-amazon-default.desktop force=yes state=absent

- name: Disable WebApps and other shitty integrations
  command: "{{ item }}"
  become: true
  become_user: "{{ user }}"
  with_items:
    - gsettings set com.canonical.unity.webapps integration-allowed false
    - gsettings set com.canonical.Unity.Lenses disabled-scopes "['more_suggestions-amazon.scope', 'more_suggestions-u1ms.scope', 'more_suggestions-populartracks.scope', 'music-musicstore.scope', 'more_suggestions-ebay.scope', 'more_suggestions-ubuntushop.scope', 'more_suggestions-skimlinks.scope']"
    - gsettings set com.canonical.unity.webapps preauthorized-domains "[]"
    - gsettings set com.canonical.Unity.ApplicationsLens display-available-apps false

- name: Remove exemples shortcut
  file: path="{{ home }}/examples.desktop" force=yes state=absent

# Reassign path :
# xdg-user-dirs-update --set NAME ABSOLUTE_PATH
#
# Available values for NAME
#   DESKTOP
#   DOWNLOAD
#   TEMPLATES
#   PUBLICSHARE
#   DOCUMENTS
#   MUSIC
#   PICTURES
#   VIDEOS

- name: Create XDG directories
  file: path="{{ home }}/{{ item }}" force=no state=directory mode=0755
  with_items:
    - Desktop
    - Downloads
    - Templates
    - Public
    - Documents
    - Music
    - Pictures
    - Videos
  
- name: Copy content of old XDG directories to new
  copy: src={{ home }}/{{ item.src }}/ dest={{ home }}/{{ item.dest }} owner={{ user }} group={{ user }}
  ignore_errors: true
  with_items:
    - { src: '{{ desktop_cleanup.xdg_directories.xdg_desktop }}', dest: 'Desktop' }
    - { src: '{{ desktop_cleanup.xdg_directories.xdg_downloads }}', dest: 'Downloads' }
    - { src: '{{ desktop_cleanup.xdg_directories.xdg_templates }}', dest: 'Templates' }
    - { src: '{{ desktop_cleanup.xdg_directories.xdg_public }}', dest: 'Public' }
    - { src: '{{ desktop_cleanup.xdg_directories.xdg_documents }}', dest: 'Documents' }
    - { src: '{{ desktop_cleanup.xdg_directories.xdg_music }}', dest: 'Music' }
    - { src: '{{ desktop_cleanup.xdg_directories.xdg_pictures }}', dest: 'Pictures' }
    - { src: '{{ desktop_cleanup.xdg_directories.xdg_videos }}', dest: 'Videos' }

- name: Remove old XDG directories
  file: path="{{ home }}/{{ item }}" force=yes state=absent
  with_items:
    - "{{ desktop_cleanup.xdg_directories.xdg_desktop }}"
    - "{{ desktop_cleanup.xdg_directories.xdg_downloads }}"
    - "{{ desktop_cleanup.xdg_directories.xdg_templates }}"
    - "{{ desktop_cleanup.xdg_directories.xdg_public }}"
    - "{{ desktop_cleanup.xdg_directories.xdg_documents }}"
    - "{{ desktop_cleanup.xdg_directories.xdg_music }}"
    - "{{ desktop_cleanup.xdg_directories.xdg_pictures }}"
    - "{{ desktop_cleanup.xdg_directories.xdg_videos }}"

- name: Update user-dirs.dirs (config file)
  copy: src="user-dirs.dirs" dest="{{ home }}/.config/user-dirs.dirs" force=yes
  
- name : Run xdg-user-dirs-update
  shell: xdg-user-dirs-update
  become: true
  become_user: "{{ user }}"
